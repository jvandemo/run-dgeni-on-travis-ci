<!doctype html>
<head>
  <meta charset="utf-8">
  <title>New Angular Router</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="style.css" rel="stylesheet">
  <link href="highlight.css" rel="stylesheet">
</head>
<body lang="en">
  
<h1>Component Lifecycle Hooks</h1><p>Lifecycle hooks let you control each stage of a route navigation.
There are four main lifecycle hooks: <a href="#can-activate"><code>canActivate</code></a>, <a href="#activate"><code>activate</code></a>, and <a href="#can-deactivate"><code>canDeactivate</code></a>, and <a href="#deactivate"><code>deactivate</code></a>.
A component can make use of these hooks by having its controller implement any number or combination of them.</p>
<p>To understand how this works, let&#39;s step through a simple case where a component wants to navigate from one route to another.</p>
<!--
TODO: expected behavior of a navigation while another navigation is completing?
-->
<h2 id="controller-constructor"><a class="anchor" href="#controller-constructor"><span class="header-link"></span></a>Controller Constructor</h2><p>Before a component can fire any lifecycle hooks, Angular needs to instantiate it.
In this phase of routing, Angular <a href="https://docs.angularjs.org/guide/di#controllers">injects the controller&#39;s dependencies</a>.</p>
<!-- <aside> -->
<p>If the controller can&#39;t be instantiated (the constructor throws), the router cancels navigation.
However, you should avoid control flow logic my means of throwing exceptions.
If you have logic that determines whether or not to perform a navigation, use the <code>canActivate</code> hook instead.
<!-- </aside> --></p>
<p>Constructors should be lightweight.
If you need to do a lot of work to setup a controller, consider using the <a href="#activate"><code>activate</code></a> lifecycle hook.</p>
<h2 id="can-activate"><a class="anchor" href="#can-activate"><span class="header-link"></span></a>canActivate</h2><p>Before switching to a new component, this hook runs for each active component in the app.
If any of them return <code>false</code>, a rejected promise, or a promise that resolves to <code>false</code>,
the navigation is cancelled.</p>
<p>This hook is useful for authentication.</p>
<h3 id="can-activate-example"><a class="anchor" href="#can-activate-example"><span class="header-link"></span></a>Example</h3><pre><code class="lang-js"><span class="identifier">angular</span>.<span class="identifier">module</span>(<span class="string">'app'</span>, [])
  .<span class="identifier">controller</span>(<span class="string">'MyController'</span>, [<span class="string">'user'</span>, <span class="string">'$http'</span>, <span class="identifier">MyController</span>]);

<span class="keyword">function</span> <span class="identifier">MyController</span>(<span class="param">user</span>, <span class="param">$http</span>) {
  <span class="control-flow">this</span>.<span class="identifier">user</span> <span class="operator">=</span> <span class="identifier">user</span>;
  <span class="control-flow">this</span>.<span class="identifier">$http</span> <span class="operator">=</span> <span class="identifier">$http</span>;
}

<span class="identifier">MyController</span>.<span class="identifier">prototype</span>.<span class="identifier">canActivate</span> <span class="operator">=</span> <span class="keyword">function</span>() {
  <span class="control-flow">return</span> <span class="control-flow">this</span>.<span class="identifier">user</span>.<span class="identifier">isAdmin</span>;
};
</code></pre>
<h2 id="activate"><a class="anchor" href="#activate"><span class="header-link"></span></a>activate</h2><p>This hook fires just before the nagivation finishes.</p>
<p>This hook is useful for cases where you want your component to do some intensive work.</p>
<h3 id="activate-example"><a class="anchor" href="#activate-example"><span class="header-link"></span></a>Example</h3><pre><code class="lang-js"><span class="identifier">angular</span>.<span class="identifier">module</span>(<span class="string">'app'</span>, [])
  .<span class="identifier">controller</span>(<span class="string">'MyController'</span>, [<span class="string">'user'</span>, <span class="string">'$http'</span>, <span class="identifier">MyController</span>]);

<span class="keyword">function</span> <span class="identifier">MyController</span>(<span class="param">user</span>, <span class="param">$http</span>) {
  <span class="control-flow">this</span>.<span class="identifier">user</span> <span class="operator">=</span> <span class="identifier">user</span>;
  <span class="control-flow">this</span>.<span class="identifier">$http</span> <span class="operator">=</span> <span class="identifier">$http</span>;
}

<span class="identifier">MyController</span>.<span class="identifier">prototype</span>.<span class="identifier">canActivate</span> <span class="operator">=</span> <span class="keyword">function</span>() {
  <span class="control-flow">return</span> <span class="control-flow">this</span>.<span class="identifier">user</span>.<span class="identifier">isAdmin</span>;
};

<span class="identifier">MyController</span>.<span class="identifier">prototype</span>.<span class="identifier">activate</span> <span class="operator">=</span> <span class="keyword">function</span>() {
  <span class="control-flow">return</span> <span class="control-flow">this</span>.<span class="identifier">bigFiles</span> <span class="operator">=</span> <span class="control-flow">this</span>.<span class="identifier">$http</span>.<span class="identifier">downloadBigFiles</span>();
};
</code></pre>
<h2 id="can-deactivate"><a class="anchor" href="#can-deactivate"><span class="header-link"></span></a>canDeactivate</h2><p>This hook fires for each component that is removed as part of navigation.
<code>canDeactivate</code> fires before any new components are instantiated.
If any of them return <code>false</code>, a rejected promise, or a promise that resolves to <code>false</code>,
the navigation is cancelled.</p>
<p><code>canDeactivate</code> is useful for making sure that data is properly persisted before navigating away.</p>
<h3 id="can-deactivate-example"><a class="anchor" href="#can-deactivate-example"><span class="header-link"></span></a>Example</h3><p>In this example, we show a dialog asking a user whether or not to save their work
before continuing.</p>
<pre><code class="lang-js"><span class="identifier">angular</span>.<span class="identifier">module</span>(<span class="string">'app.save'</span>, [])
  .<span class="identifier">controller</span>(<span class="string">'SaveController'</span>, [<span class="string">'$q'</span>, <span class="identifier">SaveController</span>]);

<span class="keyword">function</span> <span class="identifier">SaveController</span>(<span class="param">$q</span>) {
  <span class="control-flow">this</span>.<span class="identifier">$q</span> <span class="operator">=</span> <span class="identifier">$q</span>;
}

<span class="block-comment">/*
 * return a promise that is resolved based on the user's
 * choice in a dialog box
 */</span>
<span class="identifier">SaveController</span>.<span class="identifier">prototype</span>.<span class="identifier">canDeactivate</span> <span class="operator">=</span> <span class="keyword">function</span>() {
  <span class="control-flow">this</span>.<span class="identifier">deferred</span> <span class="operator">=</span> <span class="control-flow">this</span>.<span class="identifier">$q</span>.<span class="identifier">defer</span>();
  <span class="control-flow">this</span>.<span class="identifier">showSaveDialog</span> <span class="operator">=</span> <span class="boolean">true</span>;
  <span class="control-flow">return</span> <span class="control-flow">this</span>.<span class="identifier">deferred</span>.<span class="identifier">promise</span>();
};
</code></pre>
<pre><code class="lang-html"><span class="tag">&lt;<span class="title">div</span>&gt;</span>
  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-show</span>=<span class="value">"showSaveDialog"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">p</span>&gt;</span>Would you like to save your work?<span class="tag">&lt;/<span class="title">p</span>&gt;</span>
    <span class="tag">&lt;<span class="title">button</span> <span class="attribute">ng-click</span>=<span class="value">"save.deferred.resolve()"</span>&gt;</span>Save<span class="tag">&lt;/<span class="title">button</span>&gt;</span>
    <span class="tag">&lt;<span class="title">button</span> <span class="attribute">ng-click</span>=<span class="value">"save.deferred.reject()"</span>&gt;</span>Discard<span class="tag">&lt;/<span class="title">button</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
</code></pre>
<h2 id="deactivate"><a class="anchor" href="#deactivate"><span class="header-link"></span></a>deactivate</h2><p>This hook fires for each component that is removed as part of navigation.
<code>deactivate</code> is useful for doing cleanup work.</p>
<p>This hook fires after the <code>canActivate</code> of the new component and <code>canDeactivate</code> of the component to be removed, but before <code>activate</code> of the new component.</p>
<h2 id="an-example"><a class="anchor" href="#an-example"><span class="header-link"></span></a>An example</h2><p>In this example, we have a component that prevents navigation until a user saves</p>
<pre><code class="lang-js"><span class="identifier">angular</span>.<span class="identifier">module</span>(<span class="string">'app.my'</span>, [])
  .<span class="identifier">controller</span>(<span class="string">'MyController'</span>, [<span class="string">'user'</span>, <span class="string">'$http'</span>, <span class="identifier">MyController</span>]);

<span class="keyword">function</span> <span class="identifier">MyController</span>(<span class="param">user</span>, <span class="param">$http</span>) {
  <span class="control-flow">this</span>.<span class="identifier">user</span> <span class="operator">=</span> <span class="identifier">user</span>;
  <span class="control-flow">this</span>.<span class="identifier">$http</span> <span class="operator">=</span> <span class="identifier">$http</span>;
  <span class="control-flow">this</span>.<span class="identifier">userDataPersisted</span> <span class="operator">=</span> <span class="boolean">true</span>;
}

<span class="identifier">MyController</span>.<span class="identifier">prototype</span>.<span class="identifier">updateUserName</span> <span class="operator">=</span> <span class="keyword">function</span>(<span class="param">newName</span>) {
  <span class="keyword">var</span> <span class="identifier">self</span> <span class="operator">=</span> <span class="control-flow">this</span>;
  <span class="control-flow">this</span>.<span class="identifier">userDataPersisted</span> <span class="operator">=</span> <span class="boolean">false</span>;
  <span class="control-flow">return</span> <span class="control-flow">this</span>.<span class="identifier">user</span>.<span class="identifier">setName</span>(<span class="identifier">newName</span>).<span class="identifier">then</span>(<span class="keyword">function</span> () {
    <span class="identifier">self</span>.<span class="identifier">userDataPersisted</span> <span class="operator">=</span> <span class="boolean">true</span>;
  });
};

<span class="identifier">MyController</span>.<span class="identifier">prototype</span>.<span class="identifier">canActivate</span> <span class="operator">=</span> <span class="keyword">function</span>() {
  <span class="control-flow">return</span> <span class="control-flow">this</span>.<span class="identifier">user</span>.<span class="identifier">isAdmin</span>;
};

<span class="identifier">MyController</span>.<span class="identifier">prototype</span>.<span class="identifier">activate</span> <span class="operator">=</span> <span class="keyword">function</span>() {
  <span class="control-flow">this</span>.<span class="identifier">user</span>.<span class="identifier">downloadBigFiles</span>();
};

<span class="identifier">MyController</span>.<span class="identifier">prototype</span>.<span class="identifier">canDeactivate</span> <span class="operator">=</span> <span class="keyword">function</span>() {
  <span class="control-flow">return</span> <span class="control-flow">this</span>.<span class="identifier">userDataPersisted</span>;
};
</code></pre>
<!-- TODO: finish this, add example
## canReactivate and reactivate

This hook allows you to reuse a component when navigating.

It's useful for adding animations.

This hook is run if the above is true. Instead of destroying the existing component and
instantiating a new one, a component's `reactivate` hook is called when a navigation
completes.

### Example

TODO
-->
<h2 id="overview"><a class="anchor" href="#overview"><span class="header-link"></span></a>Overview</h2><p>This is the basic logic that the router uses when determining whether or not to perform a navigation.</p>
<!--
TODO: finish this
## Handling failure

What happens when a `canActivate` or `canDeactivate` returns `false`?

By default, this stops the navigation entirely.

TODO: show multiple levels
-->
<!--
## Hooks in Multiple levels
TODO: show multi-level
-->


</body>
</html>
